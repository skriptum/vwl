# Data

-   Top 1% Data from WID.World
-   Democracy and other Data from ANRR

## Imports

```{r}
library(tidyverse)
library(wid)
library(countrycode)
```

```{r}
DDCG <- haven::read_dta("data/DDCGdata.dta")
```

Get the Country Codes from the DDCG to download the respective WID Data

```{r}
iso3 <- DDCG$wbcode %>% unique()
iso2 <- countrycode(iso3, 
            origin = "iso3c", destination = "iso2c", 
            custom_match = c(
              "NAU" = "NR",
              "ROM" = "RO",
              "SER" = "RS",
              "SIN" = "SG",
              "TAW" = "TW",
              "UAE" = "AE",
              "ZAR" = "CD"
            ))
```

```{r}
WID <- download_wid(
  indicators = "sptinc", # Shares of pre-tax national income
  areas = iso2, # In the United States
  years = 1960:2010, # Time period: 2010-2015
  perc = "p99p100", # Top 1% only
  pop = "j", # Population
  include_extrapolations = TRUE, # Include extrapolations
)
```


## Clean and Merge

Clean unused Data from DDCG
```{r}
DDCG <- DDCG %>%
  dplyr::select("country_name","wbcode","dem","y", "yeardem", "year")
```

Convert WID to ISO3 Country Codes
```{r}
#| cache: true
WID <- WID %>%
  mutate(iso3 = countrycode(country, origin = "iso2c", destination = "iso3c", 
                            custom_match = c(
                              "NR" = "NAU", 
                              "RO" = "ROM", 
                              "RS" = "SER", 
                              "SG" = "SIN", 
                              "TW" = "TAW", 
                              "AE" = "UAE", 
                              "CD" = "ZAR")
                            )) %>%
  rename(top = value) %>%
  #only take values where variable = sptinc992j
  filter(variable == "sptinc992j")
```



Merge the two Data Sets
```{r}
data <- DDCG %>%
  left_join(WID, by = c("wbcode" = "iso3", "year" = "year")) %>%
  select(country_name, wbcode, year, dem, y, yeardem, top)
```

still duplicates here?


## Model

```{r}
library(plm)
```

Build general model
```{r}
pdf <- pdata.frame(data, index = c("wbcode", "year"))
```

Simple Model
```{r}
model <- plm(
  log(top) ~ dem,
  data = pdf,
  model = "within",
  effect = "twoways"
  )
summary(model)
```
Simple linear model:

```{r}
model2 <- lm(
  log(top) ~ dem,
  data = pdf
  )
summary(model2)
```

- Negative Coefficient = lower share of top 1%
- statistically significant
- but R2 is very low (not good at explaining)

Same with top 10%?
